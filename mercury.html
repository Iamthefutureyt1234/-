<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceship Navigation Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        #root {
            text-align: center;
        }
        .game-container {
            background-color: #000;
            position: relative;
            overflow: hidden;
        }
        .spaceship, .obstacle, .bullet {
            position: absolute;
        }
        .spaceship {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid blue;
        }
        .obstacle {
            width: 15px;
            height: 15px;
            background-color: red;
            border-radius: 50%;
        }
        .bullet {
            width: 5px;
            height: 5px;
            background-color: yellow;
            border-radius: 50%;
        }
        .score {
            margin-top: 10px;
            font-size: 24px;
            font-weight: bold;
        }
        .game-over {
            margin-top: 20px;
            padding: 10px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 5px;
        }
        .restart-button {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .instructions {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
        }
        .d-pad {
            display: flex;
            justify-content: space-between;
            width: 150px;
            margin: 0 auto;
        }
        .d-pad-button, .shoot-button {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.5);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .shoot-button {
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .mobile-controls {
                display: block;
            }
            .instructions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const GAME_HEIGHT = 400;
        const GAME_WIDTH = 300;
        const SPACESHIP_SIZE = 20;
        const OBSTACLE_SIZE = 15;
        const BULLET_SIZE = 5;
        const GAME_SPEED = 16; // ~60 FPS
        const PLAYER_SPEED = 5;
        const SHOOT_COOLDOWN = 500; // 0.5 seconds

        const Spaceship = ({ left }) => (
            <div className="spaceship" style={{ left, bottom: 10 }} />
        );

        const Obstacle = ({ top, left }) => (
            <div className="obstacle" style={{ top, left }} />
        );

        const Bullet = ({ top, left }) => (
            <div className="bullet" style={{ top, left }} />
        );

        const SpaceshipGame = () => {
            const [shipPosition, setShipPosition] = React.useState(GAME_WIDTH / 2);
            const [obstacles, setObstacles] = React.useState([]);
            const [bullets, setBullets] = React.useState([]);
            const [score, setScore] = React.useState(0);
            const [gameOver, setGameOver] = React.useState(false);
            const [keysPressed, setKeysPressed] = React.useState({});
            const lastShootTime = React.useRef(0);

            const handleKeyDown = React.useCallback((e) => {
                setKeysPressed((prev) => ({ ...prev, [e.key]: true }));
                if (e.key === ' ' && Date.now() - lastShootTime.current >= SHOOT_COOLDOWN) {
                    shoot();
                }
            }, []);

            const handleKeyUp = React.useCallback((e) => {
                setKeysPressed((prev) => ({ ...prev, [e.key]: false }));
            }, []);

            const handleTouchStart = React.useCallback((direction) => {
                setKeysPressed((prev) => ({ ...prev, [direction]: true }));
            }, []);

            const handleTouchEnd = React.useCallback((direction) => {
                setKeysPressed((prev) => ({ ...prev, [direction]: false }));
            }, []);

            const shoot = React.useCallback(() => {
                if (Date.now() - lastShootTime.current >= SHOOT_COOLDOWN) {
                    setBullets((prev) => [...prev, { top: GAME_HEIGHT - SPACESHIP_SIZE - 10, left: shipPosition + SPACESHIP_SIZE / 2 - BULLET_SIZE / 2 }]);
                    lastShootTime.current = Date.now();
                }
            }, [shipPosition]);

            React.useEffect(() => {
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);
                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                };
            }, [handleKeyDown, handleKeyUp]);

            React.useEffect(() => {
                if (gameOver) return;

                const gameLoop = setInterval(() => {
                    // Move player
                    setShipPosition((prev) => {
                        let newPos = prev;
                        if (keysPressed['ArrowLeft'] || keysPressed['a'] || keysPressed['left']) newPos -= PLAYER_SPEED;
                        if (keysPressed['ArrowRight'] || keysPressed['d'] || keysPressed['right']) newPos += PLAYER_SPEED;
                        return Math.max(0, Math.min(GAME_WIDTH - SPACESHIP_SIZE, newPos));
                    });

                    setObstacles((prevObstacles) => {
                        // Move obstacles
                        const movedObstacles = prevObstacles
                            .map((obs) => ({ ...obs, top: obs.top + 3 })) // Increased speed
                            .filter((obs) => obs.top < GAME_HEIGHT);

                        // Add new obstacle
                        if (Math.random() < 0.05) {
                            movedObstacles.push({
                                top: -OBSTACLE_SIZE,
                                left: Math.random() * (GAME_WIDTH - OBSTACLE_SIZE),
                            });
                        }

                        return movedObstacles;
                    });

                    setBullets((prevBullets) => {
                        return prevBullets
                            .map((bullet) => ({ ...bullet, top: bullet.top - 5 }))
                            .filter((bullet) => bullet.top > 0);
                    });

                    // Check collisions
                    setObstacles((prevObstacles) => {
                        return prevObstacles.filter((obstacle) => {
                            const hitByBullet = bullets.some(
                                (bullet) =>
                                    bullet.left < obstacle.left + OBSTACLE_SIZE &&
                                    bullet.left + BULLET_SIZE > obstacle.left &&
                                    bullet.top < obstacle.top + OBSTACLE_SIZE &&
                                    bullet.top + BULLET_SIZE > obstacle.top
                            );

                            if (hitByBullet) {
                                setScore((prevScore) => prevScore + 10);
                                return false;
                            }

                            const hitSpaceship =
                                obstacle.top + OBSTACLE_SIZE > GAME_HEIGHT - SPACESHIP_SIZE &&
                                obstacle.left < shipPosition + SPACESHIP_SIZE &&
                                obstacle.left + OBSTACLE_SIZE > shipPosition;

                            if (hitSpaceship) {
                                setGameOver(true);
                            }

                            return !hitByBullet && !hitSpaceship;
                        });
                    });

                    setBullets((prevBullets) => {
                        return prevBullets.filter((bullet) => {
                            return !obstacles.some(
                                (obstacle) =>
                                    bullet.left < obstacle.left + OBSTACLE_SIZE &&
                                    bullet.left + BULLET_SIZE > obstacle.left &&
                                    bullet.top < obstacle.top + OBSTACLE_SIZE &&
                                    bullet.top + BULLET_SIZE > obstacle.top
                            );
                        });
                    });

                    setScore((prevScore) => prevScore + 1);
                }, GAME_SPEED);

                return () => clearInterval(gameLoop);
            }, [gameOver, bullets, obstacles, shipPosition, keysPressed]);

            const restartGame = () => {
                setShipPosition(GAME_WIDTH / 2);
                setObstacles([]);
                setBullets([]);
                setScore(0);
                setGameOver(false);
                lastShootTime.current = 0;
            };

            return (
                <div>
                    <div className="game-container" style={{ width: GAME_WIDTH, height: GAME_HEIGHT }}>
                        <Spaceship left={shipPosition} />
                        {obstacles.map((obs, index) => (
                            <Obstacle key={index} top={obs.top} left={obs.left} />
                        ))}
                        {bullets.map((bullet, index) => (
                            <Bullet key={index} top={bullet.top} left={bullet.left} />
                        ))}
                    </div>
                    <div className="score">Score: {score}</div>
                    {gameOver && (
                        <div className="game-over">
                            <h2>Game Over!</h2>
                            <p>Your final score is {score}.</p>
                            <button className="restart-button" onClick={restartGame}>
                                Restart
                            </button>
                        </div>
                    )}
                    <div className="instructions">
                        Use Left/Right arrow keys or A/D keys to move. Press Spacebar to shoot.
                    </div>
                    <div className="mobile-controls">
                        <div className="d-pad">
                            <button
                                className="d-pad-button"
                                onTouchStart={() => handleTouchStart('left')}
                                onTouchEnd={() => handleTouchEnd('left')}
                            >
                                ←
                            </button>
                            <button
                                className="d-pad-button"
                                onTouchStart={() => handleTouchStart('right')}
                                onTouchEnd={() => handleTouchEnd('right')}
                            >
                                →
                            </button>
                        </div>
                        <button className="shoot-button" onTouchStart={shoot}>
                            🔫
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<SpaceshipGame />, document.getElementById('root'));
    </script>
</body>
</html>
